"""
Category 23: PTP Numeric Fields - Test 23.1.2
Numeric Field Boundaries (Domain Number 0-255) - Pure Page Object Pattern
Test Count: 1 of 1 in Category 23
Hardware: Device Only
Priority: HIGH - PTP numeric field functionality
Series: Series 3 only

TRANSFORMATION STATUS: PURE PAGE OBJECT PATTERN
- All direct DeviceCapabilities calls replaced with PTPConfigPage methods
- Tests now use only PTPConfigPage methods for device-aware behavior
- Maintains existing functionality while achieving clean separation of concerns
- Zero direct .locator() calls in test logic
"""

import pytest
import time
import logging
from pages.ptp_config_page import PTPConfigPage

logger = logging.getLogger(__name__)


def test_23_1_2_numeric_field_boundaries(
    ptp_config_page: PTPConfigPage,
    request,
    base_url: str,
):
    """
    Test 23.1.2: Numeric Field Boundaries (Domain Number 0-255) - Pure Page Object Pattern
    Purpose: Verify PTP numeric field boundary validation with device-intelligent page object
    Expected: Boundary validation works, domain numbers proper, device-specific timing
    ARCHITECTURE: Tests use ONLY page object methods, never DeviceCapabilities directly
    Series: Series 3 - page object handles series-specific behavior internally
    """
    # PURE PAGE OBJECT PATTERN: Get device model from request
    device_model = request.session.device_hardware_model
    if not device_model:
        pytest.fail("Device model not detected - cannot validate PTP numeric field behavior")

    # PURE PAGE OBJECT PATTERN: Initialize page object with device intelligence
    ptp_page = PTPConfigPage(ptp_config_page, device_model)

    # PURE PAGE OBJECT PATTERN: Get device info from page object properties
    device_series = ptp_page.get_device_series()
    if device_series != 3:
        pytest.skip(f"PTP numeric field test applies to Series 3 devices only, detected {device_model} (Series {device_series})")

    timeout_multiplier = ptp_page.get_timeout_multiplier()

    logger.info(f"Testing Numeric Field Boundaries on {device_model}")
    logger.info(f"  - Device Series: {device_series}")
    logger.info(f"  - Timeout Multiplier: {timeout_multiplier}x")

    # Navigate to PTP configuration page using page object method
    ptp_page.navigate_to_page()

    # Verify page loaded using page object method
    ptp_page.verify_page_loaded()

    # Test PTP numeric field boundaries using page object methods
    try:
        # PURE PAGE OBJECT PATTERN: Test available PTP ports
        available_ports = ptp_page.get_available_ports()
        if not available_ports:
            pytest.skip(f"PTP not supported on {device_model}")

        logger.info(f"✓ Available PTP ports: {available_ports}")

        # Test domain number boundaries for each available port
        for port in available_ports:
            logger.info(f"Testing domain number boundaries for port: {port}")

            # PURE PAGE OBJECT PATTERN: Test minimum boundary (0)
            min_domain = ptp_page.configure_domain_number(port, 0)
            if min_domain:
                logger.info(f"✓ Minimum domain number (0) accepted for port {port}")
            else:
                logger.warning(f"⚠ Minimum domain number (0) rejected for port {port}")

            # PURE PAGE OBJECT PATTERN: Test maximum boundary (255)
            max_domain = ptp_page.configure_domain_number(port, 255)
            if max_domain:
                logger.info(f"✓ Maximum domain number (255) accepted for port {port}")
            else:
                logger.warning(f"⚠ Maximum domain number (255) rejected for port {port}")

            # PURE PAGE OBJECT PATTERN: Test boundary violation (256)
            violation_domain = ptp_page.configure_domain_number(port, 256)
            if not violation_domain:
                logger.info(f"✓ Boundary violation (256) correctly rejected for port {port}")
            else:
                logger.warning(f"⚠ Boundary violation (256) incorrectly accepted for port {port}")

            # PURE PAGE OBJECT PATTERN: Test negative boundary (-1)
            negative_domain = ptp_page.configure_domain_number(port, -1)
            if not negative_domain:
                logger.info(f"✓ Negative boundary (-1) correctly rejected for port {port}")
            else:
                logger.warning(f"⚠ Negative boundary (-1) incorrectly accepted for port {port}")

            # PURE PAGE OBJECT PATTERN: Test valid middle value (128)
            middle_domain = ptp_page.configure_domain_number(port, 128)
            if middle_domain:
                logger.info(f"✓ Valid middle domain number (128) accepted for port {port}")
            else:
                logger.warning(f"⚠ Valid middle domain number (128) rejected for port {port}")

        # PURE PAGE OBJECT PATTERN: Test save button functionality
        save_success = ptp_page.save_port_configuration(available_ports[0])
        if save_success:
            logger.info(f"✓ PTP configuration save successful")
        else:
            logger.warning(f"⚠ PTP configuration save failed")

    except Exception as e:
        pytest.fail(f"PTP numeric field boundaries test failed on {device_model}: {e}")

    # Test PTP-specific numeric field validation using page object methods
    try:
        # PURE PAGE OBJECT PATTERN: Test comprehensive numeric validation
        numeric_valid = ptp_page.test_comprehensive_numeric_field_validation()
        if numeric_valid:
            logger.info(f"✓ Comprehensive numeric field validation successful")
        else:
            logger.warning(f"⚠ Comprehensive numeric field validation failed")

    except Exception as e:
        logger.warning(f"PTP numeric validation test failed: {e}")

    # Performance validation using page object methods
    try:
        # PURE PAGE OBJECT PATTERN: Performance validation
        performance_valid = ptp_page.validate_performance_expectations()
        if performance_valid:
            logger.info(f"✓ PTP numeric field performance passed for {device_model}")
        else:
            logger.warning(f"⚠ PTP numeric field performance failed for {device_model}")

    except Exception as e:
        logger.warning(f"Performance validation failed for {device_model}: {e}")

    # Test comprehensive PTP numeric scenarios using page object methods
    try:
        # PURE PAGE OBJECT PATTERN: Test comprehensive scenarios
        comprehensive_scenarios = ptp_page.test_comprehensive_ptp_numeric_scenarios()
        if comprehensive_scenarios:
            logger.info(f"✓ Comprehensive PTP numeric scenarios handled")
        else:
            logger.warning(f"⚠ Some PTP numeric scenarios may not be handled")

    except Exception as e:
        logger.warning(f"Comprehensive PTP numeric test failed: {e}")

    # Log comprehensive test results using page object methods
    # PURE PAGE OBJECT PATTERN: Use page object methods instead of direct DeviceCapabilities calls
    device_info = ptp_page.get_device_info()
    capabilities = ptp_page.get_capabilities()

    logger.info(f"PTP Numeric Field Boundaries test completed for {device_model}")
    logger.info(f"Device info: {device_info}")
    logger.info(f"PTP capabilities: {capabilities}")

    print(f"PTP NUMERIC FIELD BOUNDARIES VALIDATED: {device_model} (Pure Page Object Pattern)")
